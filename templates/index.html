{% extends "base.html" %}

{% block content %}
<div class="min-h-screen flex flex-col items-center justify-center bg-transparent px-4">
  <!-- Hero -->
  <h1 class="text-4xl md:text-5xl font-bold text-gray-800 mb-2">
    Let's Create Your <span class="text-purple-600">AI Educational Video</span>
  </h1>
  <p class="text-lg text-gray-600 mb-8">
    First craft your script or write video idea
  </p>

  <!-- Input Card -->
  <div class="w-full max-w-2xl">
    <textarea 
      id="concept"
      rows="8"
      class="w-full p-4 border-2 border-purple-400 rounded-t-lg text-black placeholder-gray-500 focus:outline-none focus:ring-2 focus:ring-secondary"
      placeholder="Type your video idea here…"></textarea>

    <!-- Bottom controls -->
    <div class="flex items-center justify-between bg-white border-2 border-t-0 border-purple-400 rounded-b-lg px-4 py-3">
      <!-- Language Selection Dropdown (Moved Left) -->
      <div class="flex items-center">
          <label for="languageSelect" class="text-sm text-gray-500 mr-1">Language:</label>
          <select id="languageSelect" name="language" aria-label="Select video language" class="text-sm text-black border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-1 focus:ring-secondary">
            <option value="af-ZA">Afrikaans (South Africa)</option>
            <option value="am-ET">Amharic (Ethiopia)</option>
            <option value="ar-EG">Arabic (Egypt)</option>
            <option value="ar-SA">Arabic (Saudi Arabia)</option>
            <option value="az-AZ">Azerbaijani (Azerbaijan)</option>
            <option value="bg-BG">Bulgarian (Bulgaria)</option>
            <option value="bn-BD">Bangla (Bangladesh)</option>
            <option value="bn-IN">Bengali (India)</option>
            <option value="bs-BA">Bosnian (Bosnia and Herzegovina)</option>
            <option value="ca-ES">Catalan (Spain)</option>
            <option value="cs-CZ">Czech (Czech)</option>
            <option value="cy-GB">Welsh (United Kingdom)</option>
            <option value="da-DK">Danish (Denmark)</option>
            <option value="de-AT">German (Austria)</option>
            <option value="de-CH">German (Switzerland)</option>
            <option value="de-DE">German (Germany)</option>
            <option value="el-GR">Greek (Greece)</option>
            <option value="en-AU">English (Australia)</option>
            <option value="en-CA">English (Canada)</option>
            <option value="en-GB">English (United Kingdom)</option>
            <option value="en-IE">English (Ireland)</option>
            <option value="en-IN">English (India)</option>
            <option value="en-US" selected>English (United States)</option>
            <option value="es-ES">Spanish (Spain)</option>
            <option value="es-MX">Spanish (Mexico)</option>
            <option value="et-EE">Estonian (Estonia)</option>
            <option value="eu-ES">Basque (Spain)</option>
            <option value="fa-IR">Persian (Iran)</option>
            <option value="fi-FI">Finnish (Finland)</option>
            <option value="fil-PH">Filipino (Philippines)</option>
            <option value="fr-BE">French (Belgium)</option>
            <option value="fr-CA">French (Canada)</option>
            <option value="fr-CH">French (Switzerland)</option>
            <option value="fr-FR">French (France)</option>
            <option value="ga-IE">Irish (Ireland)</option>
            <option value="gl-ES">Galician (Spain)</option>
            <option value="he-IL">Hebrew (Israel)</option>
            <option value="hi-IN">Hindi (India)</option>
            <option value="hr-HR">Croatian (Croatia)</option>
            <option value="hu-HU">Hungarian (Hungary)</option>
            <option value="hy-AM">Armenian (Armenia)</option>
            <option value="id-ID">Indonesian (Indonesia)</option>
            <option value="is-IS">Icelandic (Iceland)</option>
            <option value="it-IT">Italian (Italy)</option>
            <option value="ja-JP">Japanese (Japan)</option>
            <option value="jv-ID">Javanese (Indonesia)</option>
            <option value="ka-GE">Georgian (Georgia)</option>
            <option value="kk-KZ">Kazakh (Kazakhstan)</option>
            <option value="km-KH">Khmer (Cambodia)</option>
            <option value="kn-IN">Kannada (India)</option>
            <option value="ko-KR">Korean (Korea)</option>
            <option value="lo-LA">Lao (Laos)</option>
            <option value="lt-LT">Lithuanian (Lithuania)</option>
            <option value="lv-LV">Latvian (Latvia)</option>
            <option value="mk-MK">Macedonian (North Macedonia)</option>
            <option value="ml-IN">Malayalam (India)</option>
            <option value="mn-MN">Mongolian (Mongolia)</option>
            <option value="ms-MY">Malay (Malaysia)</option>
            <option value="mt-MT">Maltese (Malta)</option>
            <option value="my-MM">Burmese (Myanmar)</option>
            <option value="nb-NO">Norwegian (Bokmål, Norway)</option>
            <option value="ne-NP">Nepali (Nepal)</option>
            <option value="nl-BE">Dutch (Belgium)</option>
            <option value="nl-NL">Dutch (Netherlands)</option>
            <option value="pl-PL">Polish (Poland)</option>
            <option value="ps-AF">Pashto (Afghanistan)</option>
            <option value="pt-BR">Portuguese (Brazil)</option>
            <option value="pt-PT">Portuguese (Portugal)</option>
            <option value="ro-RO">Romanian (Romania)</option>
            <option value="ru-RU">Russian (Russia)</option>
            <option value="si-LK">Sinhala (Sri Lanka)</option>
            <option value="sk-SK">Slovak (Slovakia)</option>
            <option value="sl-SI">Slovenian (Slovenia)</option>
            <option value="so-SO">Somali (Somalia)</option>
            <option value="sq-AL">Albanian (Albania)</option>
            <option value="sr-RS">Serbian (Serbia)</option>
            <option value="su-ID">Sundanese (Indonesia)</option>
            <option value="sv-SE">Swedish (Sweden)</option>
            <option value="sw-KE">Swahili (Kenya)</option>
            <option value="ta-IN">Tamil (India)</option>
            <option value="te-IN">Telugu (India)</option>
            <option value="th-TH">Thai (Thailand)</option>
            <option value="tr-TR">Turkish (Türkiye)</option>
            <option value="uk-UA">Ukrainian (Ukraine)</option>
            <option value="ur-PK">Urdu (Pakistan)</option>
            <option value="uz-UZ">Uzbek (Uzbekistan)</option>
            <option value="vi-VN">Vietnamese (Vietnam)</option>
            <option value="zh-CN">Chinese (Mandarin, Simplified)</option>
            <option value="zh-HK">Chinese (Cantonese, Traditional)</option>
            <option value="zh-TW">Chinese (Taiwanese Mandarin)</option>
            <option value="zu-ZA">Zulu (South Africa)</option>
          </select>
      </div>

       <!-- Enhance Script Toggle (Moved Right) -->
       <div class="flex items-center">
         <span class="text-gray-500 mr-2">Enhance script</span>
         <label class="switch">
           <input type="checkbox" id="enhanceToggle">
           <span class="slider"></span>
         </label>
       </div>
       <!-- Removed Inspire Button -->
    </div>

    <!-- Next button -->
    <button 
      id="nextBtn"
      class="mt-6 w-full bg-emerald-500 hover:bg-emerald-600
             text-white font-semibold py-4 rounded-lg transition">
      Generate
    </button>
  </div>
  
  <!-- ───────────────────────────────────── -->
  <!-- Loading Overlay (hidden by default) -->
  <div id="loading" class="hidden fixed inset-0 z-50 bg-black bg-opacity-60 flex flex-col items-center justify-center">
    <div class="loading-spinner mb-4"></div>
    <p class="text-white text-lg">Generating your animation…</p>
  </div>

  <!-- Results Section (hidden by default) -->
  <div id="results" class="hidden mt-8 flex flex-col items-center w-full max-w-2xl px-4">
    <video id="animationPreview" controls class="w-full rounded-lg shadow-lg bg-black"></video>
    <a id="downloadVideo" href="#" download
       class="mt-4 bg-secondary hover:bg-secondary-dark text-white font-medium px-5 py-2 rounded-lg transition hidden">
      Download MP4
    </a>
  </div>
  <!-- ───────────────────────────────────── -->

</div>
{% endblock %}

{% block scripts %}
<script>
window.addEventListener('DOMContentLoaded', () => {
  const nextBtn = document.getElementById('nextBtn');
  if (!nextBtn) return;  // no Next button? stop here

  nextBtn.addEventListener('click', async (e) => {
    e.preventDefault();
    const conceptEl = document.getElementById('concept');
    const languageSelectEl = document.getElementById('languageSelect');

    const concept = conceptEl?.value.trim() || '';
    const language = languageSelectEl?.value || 'en-US'; // Default to en-US if element not found

    if (!concept) {
      return alert('Please enter a concept to visualize.');
    }

    // show/hide panels only if they exist
    document.getElementById('loading')?.classList.remove('hidden');
    document.getElementById('results')?.classList.add('hidden');
    document.getElementById('error')?.classList.add('hidden');
    document.getElementById('warningArea')?.classList.add('hidden');

    try {
      const res = await fetch('/generate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ concept, language }), // Include language in the request body
      });
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || `Status ${res.status}`);

      // show results
      if (data.final_video_url) {
        // if you have a <div id="results"> container:
        document.getElementById('results')?.classList.remove('hidden');

        // update video & download elements if present
        const vid = document.getElementById('animationPreview');
        if (vid) { vid.src = data.final_video_url; vid.load(); }
        const dl = document.getElementById('downloadVideo');
        if (dl) { dl.href = data.final_video_url; dl.classList.remove('hidden'); }
      }

      // show warning if any
      if (data.warning) {
        const warnArea = document.getElementById('warningArea');
        const warnMsg  = document.getElementById('warningMessage');
        if (warnArea && warnMsg) {
          warnMsg.textContent = data.warning;
          warnArea.classList.remove('hidden');
        } else {
          console.warn('Warning:', data.warning);
        }
      }

    } catch (err) {
      // fallback if you removed the #error panel
      alert(err.message);
    } finally {
      document.getElementById('loading')?.classList.add('hidden');
    }
  });
});

function showError(msg) {
    document.getElementById('errorMessage').textContent = msg;
    document.getElementById('error').classList.remove('hidden');
    document.getElementById('results').classList.add('hidden');
    document.getElementById('warningArea').classList.add('hidden');
}

function setExample(text) {
    document.getElementById('concept').value = text;
    // Clear previous results when setting a new example
    document.getElementById('results').classList.add('hidden');
    document.getElementById('error').classList.add('hidden');
    document.getElementById('warningArea').classList.add('hidden');
    document.getElementById('animationPreview').src = '';
    document.getElementById('downloadVideo').classList.add('hidden');
}

// Removed event listener for non-existent copyCodeBtn and generatedCode elements
</script>
{% endblock %}
